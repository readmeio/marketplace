// ---
// title: "AdvancedTable"
// description: "A table with advanced features."
// author: "@trishaprile"
// version: "1.0.0"
// ---

import { useState, useEffect, useMemo } from 'react';

export const AdvancedTable = ({ data }) => {
  const [query, setQuery] = useState('');
  const [currentPage, setCurrentPage] = useState(1);
	const [sortOrder, setSortOrder] = useState(null);
	const rowsPerPage = 6;

  const columns = Object.keys(data[0]);
	const firstCol = columns[0];
 
	// Filter
  const filteredData = useMemo(() => {
    return data.filter((row) =>
      columns.some((col) =>
        String(row[col] ?? '')
          .toLowerCase()
          .includes(query.toLowerCase())
      )
    );
  }, [data, query, columns]);
  
   // Sorting
  const sortedData = useMemo(() => {
    if (!sortOrder) return filteredData;
    return [...filteredData].sort((a, b) => {
      const aValue = String(a[firstCol] ?? '');
      const bValue = String(b[firstCol] ?? '');
      if (sortOrder === 'asc') return aValue.localeCompare(bValue, undefined, { numeric: true });
      return bValue.localeCompare(aValue, undefined, { numeric: true });
    });
  }, [filteredData, sortOrder, firstCol]);

	// Pagination
  const totalPages = Math.ceil(sortedData.length / rowsPerPage);
  const startIndex = (currentPage - 1) * rowsPerPage;
  const paginatedData = sortedData.slice(startIndex, startIndex + rowsPerPage);

  const goToPage = (page) => {
    if (page >= 1 && page <= totalPages) {
    	setCurrentPage(page);
  	}
  };
  
  const toggleSort = () => {
    if (!sortOrder) setSortOrder('asc');
    else if (sortOrder === 'asc') setSortOrder('desc');
    else setSortOrder(null);
  };

	// Export CSV
  const handleExport = () => {
    window.print();
  };
  
	// Reset to page 1 when filter changes
  useEffect(() => {
    setCurrentPage(1);
  }, [query]);

  return (
    <div className="space-y-2">
      <div className="flex justify-between items-center">
        <input
          type="text"
          placeholder="Filter tableâ€¦"
          value={query}
          onChange={(e) => setQuery(e.target.value)}
          className="px-3 py-1 border border-gray-300 bg-white rounded-md text-gray-800 w-50"
        />

        <button
          onClick={handleExport}
          className="px-2 py-1 text-sm bg-white border border-gray-300 rounded-md hover:bg-gray-200"
        >
          <i className="fa fa-file-csv text-gray-500" />
        </button>
      </div>

      {/* Table */}
      <div className="overflow-x-auto mb-0">
        <table className="min-w-full">
          <thead>
            <tr>
              {columns.map((col, idx) => (
                <th
                  key={col}
                  className="text-left text-gray-500! dark:text-white!"
									onClick={idx === 0 ? toggleSort : undefined}
                >
                  {col.replace(/_/g, ' ')}
                  {idx === 0 && sortOrder === 'asc' && <i className="fa fa-arrow-up pl-2 text-[10px] font-bold" />}
                  {idx === 0 && (sortOrder === 'desc' || sortOrder === null) && <i className="fa fa-arrow-down pl-2 text-[10px] font-bold" />}
                </th>
              ))}
            </tr>
          </thead>
          <tbody>
            {paginatedData.map((row, i) => (
              <tr key={i}>
                {columns.map((col) => (
                  <td key={col}>
                    {String(row[col] ?? '')}
                  </td>
                ))}
              </tr>
            ))}
            {paginatedData.length === 0 && (
              <tr>
                <td
                  colSpan={columns.length}
                  className="text-gray-400"
                >
                  No matching results
                </td>
              </tr>
            )}
          </tbody>
        </table>
      </div>
      
			{/* Pagination */}
      <div className="">
        <div className="flex items-center gap-1">
          <button
            className="px-3 text-gray-500 rounded font-bold disabled:opacity-50 bg-inherit border-none hover:not-disabled:text-gray-800"
            onClick={() => goToPage(currentPage - 1)}
            disabled={currentPage === 1}
          >
            <i className="fa fa-chevron-left text-xs text-gray-400 pr-1"/> Previous
          </button>
          {Array.from({ length: totalPages }).map((_, idx) => (
            <button
              key={idx}
              onClick={() => goToPage(idx + 1)}
              className={`px-3 py-1 text-sm rounded ${
                currentPage === idx + 1
                  ? 'bg-blue-100 text-blue-400 font-bold rounded-md border-none'
                  : 'text-gray-500 hover:bg-gray-100 font-bold border-none bg-inherit'
              }`}
            >
              {idx + 1}
            </button>
          ))}
          <button
            className="px-3 text-xsx text-gray-500 rounded font-bold disabled:opacity-50 bg-inherit border-none hover:not-disabled:text-gray-800"
            onClick={() => goToPage(currentPage + 1)}
            disabled={currentPage === totalPages}
          >
            Next <i className="fa fa-chevron-right font-bold text-xs text-gray-400 pl-1"/>
          </button>
        </div>
      </div>
    </div>
  );
};

<AdvancedTable
  data={[
    { Feature: '1 Linter', Version: 'v1.0', Status: 'In Progress', 'Release Date': 'Oct 1, 2025' },
    { Feature: '2 AI Agent', Version: 'v1.0', Status: 'Beta', 'Release Date': 'Aug 31, 2025' },
    { Feature: '3 Components', Version: 'v3.2', Status: 'Complete', 'Release Date': 'Mar 1, 2025' },
    { Feature: '4 Refactored UI', Version: 'v2.3', Status: 'Complete', 'Release Date': 'Feb 1, 2025' },
    { Feature: '5 Refactored UI', Version: 'v2.3', Status: 'Complete', 'Release Date': 'Feb 1, 2025' },
    { Feature: '6 Refactored UI', Version: 'v2.3', Status: 'Complete', 'Release Date': 'Feb 1, 2025' },
		{ Feature: '7 Refactored UI', Version: 'v2.3', Status: 'Complete', 'Release Date': 'Feb 1, 2025' },
    { Feature: '8 Refactored UI', Version: 'v2.3', Status: 'Complete', 'Release Date': 'Feb 1, 2025' },
		{ Feature: '9 Refactored UI', Version: 'v2.3', Status: 'Complete', 'Release Date': 'Feb 1, 2025' },
  ]}
/>
